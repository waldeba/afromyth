{{ define "main" }}
<main class="product-page">
  <div class="product-container">
    <div class="product-gallery">
      {{ if .Params.gallery }}
        {{ range .Params.gallery }}
          <div class="gallery-item">
            <img src="{{ . | relURL }}" alt="{{ $.Title }}" class="gallery-img" loading="lazy">
            <button class="pinterest-pin-btn" onclick="pinToBoard(this)" title="Pin to Pinterest">
              <svg width="20" height="20" viewBox="0 0 384 512" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path d="M204 6.5C101.4 6.5 0 74.9 0 185.6 0 256 39.6 296 63.6 296c9.9 0 15.6-27.6 15.6-35.4 0-9.3-23.7-29.1-23.7-67.8 0-80.4 61.2-137.4 140.4-137.4 68.1 0 118.5 38.7 118.5 109.8 0 53.1-21.3 152.7-90.3 152.7-24.9 0-46.2-18-39.8-39.8 7.8-26.4 22.9-54.9 22.9-74.1 0-17.2-9.2-31.6-28.5-31.6-22.6 0-40.7 23.4-40.7 54.7 0 19.9 6.7 33.4 6.7 33.4s-23.1 97.8-27.1 114.8c-8.1 34.1-1.2 75.9-0.6 80.1 0.3 2.5 3.6 3.1 5.1 1.2 2.2-2.8 30.7-38.1 39.6-71.4 2.6-9.8 14.8-57.8 14.8-57.8 7.3 13.9 28.7 26.1 51.4 26.1 67.6 0 113.4-61.6 113.4-144.2C384 86.6 314.9 6.5 204 6.5z"/>
              </svg>
            </button>
          </div>
        {{ end }}
      {{ else if .Params.image }}
        <div class="gallery-item">
          <img src="{{ .Params.image | relURL }}" alt="{{ .Title }}" class="gallery-img">
          <button class="pinterest-pin-btn" onclick="pinToBoard(this)" title="Pin to Pinterest">
            <svg width="20" height="20" viewBox="0 0 384 512" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
              <path d="M204 6.5C101.4 6.5 0 74.9 0 185.6 0 256 39.6 296 63.6 296c9.9 0 15.6-27.6 15.6-35.4 0-9.3-23.7-29.1-23.7-67.8 0-80.4 61.2-137.4 140.4-137.4 68.1 0 118.5 38.7 118.5 109.8 0 53.1-21.3 152.7-90.3 152.7-24.9 0-46.2-18-39.8-39.8 7.8-26.4 22.9-54.9 22.9-74.1 0-17.2-9.2-31.6-28.5-31.6-22.6 0-40.7 23.4-40.7 54.7 0 19.9 6.7 33.4 6.7 33.4s-23.1 97.8-27.1 114.8c-8.1 34.1-1.2 75.9-0.6 80.1 0.3 2.5 3.6 3.1 5.1 1.2 2.2-2.8 30.7-38.1 39.6-71.4 2.6-9.8 14.8-57.8 14.8-57.8 7.3 13.9 28.7 26.1 51.4 26.1 67.6 0 113.4-61.6 113.4-144.2C384 86.6 314.9 6.5 204 6.5z"/>
            </svg>
          </button>
        </div>
      {{ else }}
        <div class="placeholder-img">{{ .Title }}</div>
      {{ end }}
      
      <!-- Delivery & Return Section -->
      <div class="delivery-returns">
        <div class="delivery-returns-header" onclick="toggleDeliveryReturns(this)">
          <span>D E L I V E R Y &nbsp; &amp; &nbsp; R E T U R N</span>
          <span>+</span>
        </div>
        <div class="delivery-returns-content">
          <p>We aim to dispatch your order within 24/48h Monday - Friday*.</p>
          <h4>UK Mainland / Collection</h4>
          <ul>
            <li>FREE Standard Delivery over £150*</li>
            <li>Standard Delivery (3 - 5 working days) £5.95*</li>
            <li>Expedited Delivery (2 - 3 working days) £8.50*</li>
          </ul>
          <p>Collect FREE from AFROMYTH Studio</p>
          <h4>International Orders</h4>
          <p>International Orders please contact us.</p>
          <h4>Returns</h4>
          <p>Should you change your mind about an item, we are happy to offer an exchange or a refund. All we ask is that you return the item to us in an unused state and in its original packaging within 14 days of receipt.</p>
        </div>
      </div>
    </div>

    <div class="product-info">
      <div class="breadcrumb">
        <span>SKU: {{ .Params.sku | default "N/A" }} | HANDCRAFTED BY ARTISANS</span>
      </div>
      
      <h1>{{ .Title }}</h1>
      
      <div class="price">{{ .Params.price | default "Contact for Price" }}</div>
      
      <div class="qty">
        <button onclick="decreaseQty()">-</button>
        <span id="quantity">1</span>
        <button onclick="increaseQty()">+</button>
      </div>
      
      <div class="stock-status">
        {{ if .Params.in_stock }}✓ In Stock{{ else }}⚠ Contact for Availability{{ end }}
      </div>
      
      <button class="add-to-cart" onclick="addToCart()">Add to Cart</button>
      
      <div class="product-description">
        {{ .Content }}
        
        {{ if .Params.why_we_love_it }}
        <h3>Why we love it</h3>
        <ul>
          {{ range .Params.why_we_love_it }}
          <li>{{ . }}</li>
          {{ end }}
        </ul>
        {{ end }}
        
        {{ if .Params.details }}
        <h3>Details you'll appreciate</h3>
        <ul>
          {{ range .Params.details }}
          <li>{{ . }}</li>
          {{ end }}
        </ul>
        {{ end }}
      </div>
      
      <div class="product-meta">
        {{ if .Params.sku }}<div><strong>SKU:</strong> {{ .Params.sku }}</div>{{ end }}
        {{ if .Params.dimensions }}<div><strong>Dimensions:</strong> {{ .Params.dimensions }}</div>{{ end }}
        {{ if .Params.material }}<div><strong>Material:</strong> {{ .Params.material }}</div>{{ end }}
        {{ if .Params.color }}<div><strong>Colour:</strong> {{ .Params.color }}</div>{{ end }}
        {{ if .Params.origin }}<div><strong>Origin:</strong> {{ .Params.origin }}</div>{{ end }}
        {{ if .Params.artist }}<div><strong>Artist:</strong> {{ .Params.artist }}</div>{{ end }}
      </div>
    </div>
  </div>
</main>

<!-- Related Products Section -->
{{ if .Params.related_products }}
<section class="recommendations">
  <h2>You may also like</h2>
  <div class="recommendations-grid">
    {{ range .Params.related_products }}
    <div class="rec-product">
      {{ if .image }}
        <img src="{{ .image | relURL }}" alt="{{ .title }}">
      {{ else }}
        <div class="placeholder-img">{{ .title }}</div>
      {{ end }}
      <h3>{{ .title }}</h3>
      <div class="price">{{ .price }}</div>
      {{ if .badge }}<div class="badge">{{ .badge }}</div>{{ end }}
    </div>
    {{ end }}
  </div>
</section>
{{ end }}

<style>
:root {
  --font-serif: 'Playfair Display', serif;
  --font-sans: var(--font-sans);
  --font-mono: 'JetBrains Mono', monospace;
  --font-logo: 'Rammetto One', cursive;
  --font-menu: 'Fjalla One', sans-serif;
  --font-paragraph: 'Maven Pro', sans-serif;
  --font-body: 'Work Sans', sans-serif;
  --color-muted: #555;
  --color-accent: #3d2b1f;
  --logo-color: rgb(184,115,51);
}

.product-page {
  max-width: 1240px;
  margin: 2rem auto;
  padding: 0 1rem;
}

.product-container {
  display: flex;
  gap: 2rem;
  margin-bottom: 3rem;
}

.product-gallery {
  flex: 1.1;
  min-width: 300px;
}

.gallery-item {
  position: relative;
  margin-bottom: 1rem;
  display: block;
}

.gallery-img {
  width: 100%;
  display: block;
}

.pinterest-pin-btn {
  position: absolute;
  top: 1rem;
  right: 1rem;
  background: #e60023;
  color: white;
  border: none;
  border-radius: 50%;
  width: 48px;
  height: 48px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  opacity: 1; /* Always visible for testing */
  transition: all 0.3s ease;
  z-index: 10;
  box-shadow: 0 2px 8px rgba(0,0,0,0.15);
}

.pinterest-pin-btn:hover {
  background: #bd081c;
  transform: scale(1.1);
  box-shadow: 0 4px 12px rgba(0,0,0,0.25);
}

.pinterest-pin-btn svg {
  width: 22px;
  height: 22px;
}

.placeholder-img {
  width: 100%;
  height: 400px;
  background: #f5f5f5;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #999;
  font-size: 0.9rem;
  margin-bottom: 1rem;
}

.delivery-returns {
  margin-top: 2rem;
}

.delivery-returns-header {
  font-family: var(--font-body);
  font-weight: 300;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  padding: 1rem 0;
  border-top: 1px solid var(--border);
  display: flex;
  justify-content: space-between;
  cursor: pointer;
  font-size: 0.8rem;
  color: var(--color-muted);
}

.delivery-returns-header span:last-child {
  font-weight: 700;
  font-size: 1rem;
  color: var(--color-dark);
}

.delivery-returns-content {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s ease;
  color: var(--color-muted);
  padding: 0 0.25rem;
}

.delivery-returns-content.open {
  max-height: 800px;
  padding-top: 1rem;
}

.delivery-returns-content h4 {
  font-family: var(--font-serif);
  font-size: 0.95rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin: 1rem 0 0.5rem 0;
  color: var(--color-dark);
}

.delivery-returns-content h4:first-child {
  margin-top: 0;
}

.delivery-returns-content p {
  margin-bottom: 0.75rem;
  color: var(--color-muted);
  font-family: var(--font-body);
  font-weight: 400;
}

.delivery-returns-content ul {
  margin-bottom: 1rem;
  padding-left: 1rem;
  font-family: var(--font-body);
  font-weight: 400;
}

.delivery-returns-content li {
  margin-bottom: 0.25rem;
  color: var(--color-muted);
  font-family: var(--font-body);
  font-weight: 400;
}

.product-info {
  flex: 1;
  min-width: 300px;
  position: sticky;
  top: 100px;
  align-self: flex-start;
  height: fit-content;
}

.breadcrumb {
  font-size: 0.75rem;
  color: var(--color-muted);
  text-transform: uppercase;
  letter-spacing: 0.1em;
  margin-bottom: 0.5rem;
}

.product-info h1 {
  font-family: var(--font-body);
  font-weight: 700;
  font-size: 1.4rem;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  margin-bottom: 0.5rem;
}

.stock-status {
  color: var(--color-muted);
  margin: 1rem 0;
}

.price {
  font-family: var(--font-body);
  font-weight: 600;
  font-size: 1.2rem;
  margin: 0.5rem 0 1rem;
  color: #4a4a4a;
}

.qty {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin: 1rem 0;
}

.qty button {
  width: 2rem;
  height: 2rem;
  font-size: 1.1rem;
  border: 1px solid #000;
  background: none;
  cursor: pointer;
  color: #000;
}

.qty button:hover {
  background: #000;
  color: #fff;
}

.add-to-cart {
  background-color: #000;
  color: #fff;
  font-family: var(--font-body);
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  padding: 1rem;
  border: none;
  width: 100%;
  margin-bottom: 1.5rem;
  cursor: pointer;
}

.add-to-cart:hover {
  background-color: #333;
}

.product-description {
  margin-bottom: 1.5rem;
}

.product-description p {
  font-family: var(--font-body);
  font-weight: 400;
  margin-bottom: 1rem;
}

.product-description h3 {
  font-family: var(--font-serif);
  font-size: 1rem;
  margin: 1rem 0 0.5rem;
}

.product-description ul {
  font-family: var(--font-body);
  font-weight: 400;
  padding-left: 1.25rem;
  color: var(--color-muted);
  margin-bottom: 1rem;
}

.product-meta {
  border-top: 1px solid var(--border);
  padding-top: 1rem;
}

.product-meta div {
  margin-bottom: 0.5rem;
  font-family: var(--font-body);
  font-size: 0.9rem;
  color: var(--color-muted);
}

.recommendations {
  max-width: 1240px;
  margin: 0 auto 3rem;
  padding: 0 1rem;
}

.recommendations h2 {
  font-family: var(--font-serif);
  font-size: 1.5rem;
  font-weight: 400;
  text-transform: uppercase;
  letter-spacing: 0.15em;
  text-align: center;
  margin-bottom: 2rem;
  color: var(--color-dark);
}

.recommendations-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 2rem;
  justify-items: center;
}

@media (max-width: 1200px) {
  .recommendations-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 1.5rem;
  }
}

@media (max-width: 900px) {
  .recommendations-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
  }
}

@media (max-width: 600px) {
  .recommendations-grid {
    grid-template-columns: 1fr;
    gap: 1.5rem;
  }
}

.rec-product {
  text-align: center;
  position: relative;
}

.rec-product img {
  width: 100%;
  aspect-ratio: 1;
  object-fit: cover;
  margin-bottom: 1rem;
  transition: opacity 0.2s ease;
}

.rec-product img:hover {
  opacity: 0.85;
}

.rec-product .placeholder-img {
  width: 100%;
  aspect-ratio: 1;
  background: #f5f5f5;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #999;
  font-size: 0.9rem;
  margin-bottom: 1rem;
}

.rec-product h3 {
  font-family: var(--font-serif);
  font-size: 1rem;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  margin-bottom: 0.5rem;
  color: var(--color-dark);
}

.rec-product .price {
  font-family: var(--font-body);
  font-weight: 600;
  font-size: 1.1rem;
  color: #4a4a4a;
  margin: 0;
}

.badge {
  position: absolute;
  top: 1rem;
  right: 1rem;
  background: #6b4423;
  color: white;
  padding: 0.25rem 0.5rem;
  font-size: 0.7rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

/* Responsive Design */
@media (max-width: 768px) {
  .product-container {
    flex-direction: column;
    gap: 1rem;
  }
  
  .product-info {
    position: static;
  }
  
  .rec-product h3 {
    font-size: 0.9rem;
  }
}
</style>

<script>
let quantity = 1;

function increaseQty() {
  quantity++;
  document.getElementById('quantity').textContent = quantity;
}

function decreaseQty() {
  if (quantity > 1) {
    quantity--;
    document.getElementById('quantity').textContent = quantity;
  }
}

function addToCart() {
  alert(`Added ${quantity} {{ .Title }} to cart!`);
}

function toggleDeliveryReturns(header) {
  const content = header.nextElementSibling;
  const symbol = header.querySelector('span:last-child');
  
  content.classList.toggle('open');
  symbol.textContent = content.classList.contains('open') ? '−' : '+';
}

function pinToBoard(button) {
  const galleryItem = button.closest('.gallery-item');
  const img = galleryItem.querySelector('.gallery-img');
  const imageUrl = new URL(img.src).href;
  const description = encodeURIComponent('{{ .Title }} - {{ .Params.price | default "African Cultural Artifact" }}');
  const currentPageUrl = encodeURIComponent(window.location.href);
  
  const pinterestUrl = `https://pinterest.com/pin/create/button/?url=${currentPageUrl}&media=${encodeURIComponent(imageUrl)}&description=${description}`;
  
  // Open Pinterest in a new window
  window.open(pinterestUrl, 'pinterest-share', 'width=750,height=350,scrollbars=yes,resizable=yes');
  
  // Visual feedback
  button.style.background = '#28a745';
  setTimeout(() => {
    button.style.background = '#e60023';
  }, 1000);
}
</script>
{{ end }}
